# Dark Minimal Design System — Implementation Spec

**Status:** Finalized  
**Date:** 2026-02-20  
**Source:** [DarkMinimalDesign.md](./DarkMinimalDesign.md)

---

## Decisions

| Decision | Choice |
|---|---|
| Light mode | **Removed** — dark only, no toggle |
| Shiki code theme | **vitesse-dark**, background overridden to `#121212` |
| Library schema | **No changes** — visual redesign only |
| Library card layout | **Vertical** — cover on top, text below |
| Tailwind Typography plugin | **Drop** — hand-roll all prose styles |
| Text hierarchy | **Semantic tokens** — replace all `opacity-*` patterns |
| Terminal/Typewriter toggle | **Include** |
| Blog max width | **680px** (`42.5rem`) |
| Library max width | **1100px** (`68.75rem`) |
| Color management | **Centralized** — single `src/theme.ts` as source of truth |

---

## 1. Centralized Color Management

### Architecture

All color hex values, typography numbers, and reading-mode overrides are defined in a single TypeScript file: `src/theme.ts`. This is the only place hex values live. Everything else consumes from it.

**Data flow:**

```
src/theme.ts  (single source of truth — hex values + typography numbers)
     │
     ├──→ Layout.astro         → imports theme, generates <style>:root { ... }</style>
     ├──→ og-templates/*.js    → imports hex values directly for Satori
     └──→ (future consumers)   → email templates, PDF export, etc.

src/styles/global.css
     └──→ @theme inline        → static mapping of CSS var NAMES → Tailwind token names
                                  (never changes when colors change)
```

### What `src/theme.ts` Contains

A structured object exporting:
- All background colors (root, elevated, subtle, hover)
- All border colors (subtle, strong)
- All text colors (primary, secondary, muted, disabled, heading `#DADADA`, heading-hero `#FFFFFF`)
- All accent colors (brass, wine, tertiary)
- Code block colors (background `#121212`, text `#DCDCDC`)
- Typography values (base font size, line heights, max widths)
- Terminal mode overrides (values that differ from base)
- Typewriter mode overrides (values that differ from base)

Every hex value used anywhere in the project must come from this file — no hardcoded hex values in CSS or components. This includes code block backgrounds, heading colors, and any other one-off values.

### How Each Consumer Uses It

| Consumer | What it does | Runtime |
|---|---|---|
| `Layout.astro` | Imports the theme object, loops over it to generate a `<style>:root { --bg-root: #0E0E0E; ... }</style>` tag | Build → Browser |
| `global.css` `@theme inline` | References CSS var *names* to create Tailwind utilities (e.g., `--color-bg-root: var(--bg-root)`). This block is static — it maps names, not values. Never changes when colors change. | Build (Tailwind) |
| OG templates | Import hex values directly (e.g., `theme.colors.bgRoot`) for Satori inline styles | Build (Node) |
| Terminal/Typewriter CSS | `Layout.astro` also generates `[data-reading-mode="typewriter"] { --text-primary: #EDE6D6; ... }` from the override objects in theme.ts | Build → Browser |

### What This Replaces

The `:root` color block currently in `global.css` moves out of CSS and into being generated by `Layout.astro`. The `@theme inline` block stays in `global.css` unchanged — it only maps var names to Tailwind tokens and doesn't care about actual hex values.

### Why This Matters

- **One file to change.** Swap brass to copper, adjust a background — one edit, zero drift.
- **OG images stay in sync.** They read from the same source as the site.
- **Type-safe.** TypeScript catches typos in token names at build time.
- **Reading mode overrides live next to base values.** Makes it obvious what changes between Terminal and Typewriter modes.

---

## 2. Color Token System

Remove the light/dark toggle. Replace the current 5-token system with the full design system palette. All values are dark-only.

### Current → New Token Mapping

```
REMOVE:
  :root / html[data-theme="light"] block  (entire light theme)
  html[data-theme="dark"] block            (no longer conditional)
  @custom-variant dark (...)               (no longer needed)

REPLACE WITH single :root block:
```

### New CSS Custom Properties

```css
:root {
  /* Backgrounds */
  --bg-root: #0E0E0E;
  --bg-elevated: #161616;
  --bg-subtle: #1A1A1A;
  --bg-hover: #1F1F1F;

  /* Borders */
  --border-subtle: #2A2A2A;
  --border-strong: #3A3A3A;

  /* Text */
  --text-primary: #E6E6E6;
  --text-secondary: #A8A8A8;
  --text-muted: #7A7A7A;
  --text-disabled: #5A5A5A;

  /* Accent — Warm Brass */
  --accent-primary: #D4A259;
  --accent-primary-hover: #E6B86A;
  --accent-primary-muted: #7A5A2E;

  /* Accent — Muted Wine */
  --accent-secondary: #8C5A6A;
  --accent-secondary-muted: #5A3A45;

  /* Accent — Tertiary (rare) */
  --accent-tertiary: #6F7B4A;
}
```

### Tailwind @theme inline Mapping

```css
@theme inline {
  --font-app: "iA Writer Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;

  --color-bg-root: var(--bg-root);
  --color-bg-elevated: var(--bg-elevated);
  --color-bg-subtle: var(--bg-subtle);
  --color-bg-hover: var(--bg-hover);

  --color-border-subtle: var(--border-subtle);
  --color-border-strong: var(--border-strong);

  --color-text-primary: var(--text-primary);
  --color-text-secondary: var(--text-secondary);
  --color-text-muted: var(--text-muted);
  --color-text-disabled: var(--text-disabled);

  --color-accent-primary: var(--accent-primary);
  --color-accent-primary-hover: var(--accent-primary-hover);
  --color-accent-primary-muted: var(--accent-primary-muted);
  --color-accent-secondary: var(--accent-secondary);
  --color-accent-secondary-muted: var(--accent-secondary-muted);
  --color-accent-tertiary: var(--accent-tertiary);
}
```

### Tailwind Class Migration

Old classes → new classes (find & replace across all components):

| Old | New |
|---|---|
| `bg-background` | `bg-bg-root` |
| `bg-muted` | `bg-bg-subtle` |
| `text-foreground` | `text-text-primary` |
| `text-accent` | `text-accent-primary` |
| `border-border` | `border-border-subtle` |
| `outline-accent` | `outline-accent-primary` |
| `selection:bg-accent` | `selection:bg-accent-primary` |
| `selection:text-background` | `selection:text-bg-root` |
| `hover:text-accent` | `hover:text-accent-primary-hover` |
| `opacity-80` (on text) | `text-text-secondary` |
| `opacity-70` (on text) | `text-text-secondary` |
| `opacity-60` (on text) | `text-text-muted` |
| `opacity-50` (disabled) | `text-text-disabled` |

---

## 3. Files to Modify

### 3.0 Create — Centralized Theme

| File | Purpose |
|---|---|
| `src/theme.ts` | **New file.** Single source of truth for all color hex values, typography numbers, and reading-mode overrides. Consumed by `Layout.astro` and OG templates. |

### 3.1 Remove — Theme Toggle Infrastructure

| File | Change |
|---|---|
| `src/config.ts` | Set `lightAndDarkMode: false` |
| `src/scripts/theme.ts` | Remove entirely or gut to a no-op (no toggle logic needed) |
| `src/layouts/Layout.astro` | Remove inline theme script, hardcode `data-theme="dark"` on `<html>`, remove theme meta-color logic |
| `src/components/Header.astro` | Remove the theme toggle `<button id="theme-btn">` and its sun/moon icons |

### 3.2 Modify — Styles

| File | Change |
|---|---|
| `src/styles/global.css` | **Remove** the `:root` color block (hex values move to `theme.ts`). Remove `@custom-variant dark`. Remove light theme block. Keep `@theme inline` (update to new token names — this block is static, maps var names only). Update `@layer base` selectors to use new tokens. Update `max-w-app` to `42.5rem`. Add new `max-w-library` utility (`68.75rem`). |
| `src/styles/typography.css` | **Rewrite entirely.** Remove `@plugin "@tailwindcss/typography"`. Hand-roll all prose styles using design system tokens. See Section 3. |
| `package.json` | Remove `@tailwindcss/typography` from devDependencies |

### 3.3 Modify — Layouts

| File | Change |
|---|---|
| `src/layouts/Layout.astro` | Hardcode dark theme. Remove theme toggle script. Import `theme.ts` and generate `<style>:root { ... }</style>` dynamically. Generate reading-mode CSS overrides from theme. Update meta theme-color to static value. |
| `src/layouts/Main.astro` | Update text classes to semantic tokens |
| `src/layouts/PostDetails.astro` | H1 → `text-white` (pure white for hero titles). Update `text-accent` → `text-accent-primary`. Remove `dark:` prefixed classes. |
| `src/layouts/BookDetails.astro` | Update to semantic tokens. Remove `dark:` prefixes. |
| `src/layouts/AboutLayout.astro` | Update to semantic tokens |

### 3.4 Modify — Components

| Component | Changes |
|---|---|
| `Header.astro` | Remove theme toggle button + sun/moon icons. Update color classes. |
| `Footer.astro` | `border-border` → `border-border-subtle` |
| `Card.astro` | `text-accent` → `text-accent-primary`. Opacity patterns → semantic tokens. |
| `BookCard.astro` | **Redesign to vertical layout.** Cover on top, text below. Use `bg-bg-elevated`, `hover:bg-bg-hover`. Author → `text-text-secondary`. Genre tags → `text-accent-primary`. |
| `Tag.astro` | `border-foreground` → `border-text-primary`. `text-accent` → `text-accent-primary`. |
| `Datetime.astro` | Replace opacity with `text-text-secondary` or `text-text-muted` |
| `Breadcrumb.astro` | Replace `opacity-80/70/75` with `text-text-secondary`, `text-text-muted` |
| `Pagination.astro` | `opacity-50` disabled → `text-text-disabled` |
| `BackToTopButton.astro` | Update `bg-background` → `bg-bg-root`. Accent references stay mapped. |
| `BackButton.astro` | Update to semantic tokens |
| `ShareLinks.astro` | Update to semantic tokens |
| `EditPost.astro` | Update to semantic tokens |
| `Socials.astro` | Update to semantic tokens |
| `LinkButton.astro` | Update to semantic tokens |

### 3.5 Modify — Pages

| Page | Changes |
|---|---|
| `src/pages/index.astro` | Update `border-border` → `border-border-subtle`. Replace opacity text. Group heading → `text-text-secondary`. Date → `text-text-muted`. |
| `src/pages/search.astro` | Remap Pagefind CSS vars to new tokens. Remove `dark:` references. |
| `src/pages/404.astro` | Update to semantic tokens |
| `src/pages/about.md` | No change (content file) |
| `src/pages/library/[...page].astro` | Update to semantic tokens |
| `src/pages/blog/[...page].astro` | Update to semantic tokens |
| `src/pages/tags/*` | Update to semantic tokens |

### 3.6 Modify — OG Image Templates

| File | Change |
|---|---|
| `src/utils/og-templates/post.js` | Import colors from `src/theme.ts` instead of hardcoded hex values |
| `src/utils/og-templates/site.js` | Import colors from `src/theme.ts` instead of hardcoded hex values |
| `src/utils/loadGoogleFont.ts` | **Replace or adapt.** iA Writer Mono is not a Google Font — it's loaded via `@fontsource`. To use it in OG images, load the `.woff2` font file from the `@fontsource/ia-writer-mono` package and pass it to Satori as a font buffer. Alternatively, fall back to a visually similar Google Font (e.g., JetBrains Mono) for OG images only. |

### 3.7 Modify — Astro Config

| File | Change |
|---|---|
| `astro.config.ts` | Change Shiki theme from `night-owl` to `vitesse-dark`. Remove `light: "min-light"` (dark only). |

---

## 4. Typography — Hand-Rolled Prose Styles

Replace `@tailwindcss/typography` with custom `.app-prose` styles.

### Base

```
html         → font-size: 18px
body         → line-height: 1.8
blog content → max-width: 680px (42.5rem)
library      → max-width: 1100px (68.75rem)
```

### Heading Scale

| Element | Size | Weight | Line Height | Color |
|---|---|---|---|---|
| H1 | 2.2rem | 600 | 1.2 | `#FFFFFF` (pure white) |
| H2 | 1.6rem | 600 | 1.3 | `#DADADA` |
| H3 | 1.3rem | 500 | 1.4 | `#DADADA` |
| H4 | 1.1rem | 500 | 1.4 | `#DADADA` |

Rules:
- No uppercase headings
- No letter-spacing
- Margin-top: `2.5rem+`
- Margin-bottom: `0.75rem`

### Paragraph & Spacing

- Paragraph bottom margin: `1.6rem`
- Section spacing (between major blocks): `3rem`

### Element Styles

| Element | Style |
|---|---|
| Body text | `--text-primary` (`#E6E6E6`) |
| Links | Color: `--accent-primary`. Hover: underline + `--accent-primary-hover` |
| Blockquotes | Left border: `--accent-primary-muted`. Text: `--accent-secondary` |
| Inline code | Background: `#121212`. Border: `--border-subtle`. Padding: `2px 6px`. Border-radius: `4px` |
| Code blocks | Background: `#121212`. Padding: `1.4rem`. Border: `1px solid var(--border-subtle)`. Font-size: `0.95rem` |
| Lists | Marker color: `--accent-primary` |
| Horizontal rules | `--border-subtle` |
| Images | Border: `--border-subtle` |
| Tables | Cell border: `--border-subtle`. Header: slightly elevated background |
| Figcaption | `--text-muted` |

---

## 5. Shiki Config Change

Switching from dual themes (`themes: { light, dark }`) to a single theme (`theme`) changes Shiki's HTML output. Currently Shiki generates `--shiki-light` and `--shiki-dark` CSS custom properties per token. A single theme uses plain inline `color` styles instead. This means all CSS referencing `--shiki-light-bg`, `--shiki-dark-bg`, `--shiki-light`, `--shiki-dark` will break and must be removed.

```ts
// astro.config.ts
shikiConfig: {
  theme: "vitesse-dark",   // single theme, no light/dark split
  defaultColor: false,
  wrap: false,
  // ... transformers stay the same
}
```

Override vitesse-dark's background in CSS (value comes from `theme.ts` via the generated `:root` block):

```css
.astro-code {
  background-color: var(--code-bg) !important;
  border: 1px solid var(--border-subtle);
}
```

**Breaking references to remove:**
- `typography.css`: Remove `.astro-code` rules referencing `--shiki-light-bg`, `--shiki-dark-bg`, `--shiki-light`, `--shiki-dark`
- `PostDetails.astro`: Remove `prose-pre:bg-(--shiki-light-bg)` and `dark:prose-pre:bg-(--shiki-dark-bg)` classes
- `BookDetails.astro`: Same — remove Shiki dual-theme class references

---

## 6. Library Card — Vertical Layout

New structure for `BookCard.astro`:

```
┌─────────────────────┐
│                     │
│    [ Cover Image ]  │
│                     │
├─────────────────────┤
│ Title        (white)│
│ Author    (secondary)│
│ Tags        (brass) │
│ Date        (muted) │
└─────────────────────┘
```

- Card background: `--bg-elevated`
- Hover: background → `--bg-hover`, border → `--accent-primary-muted`
- No shadows. No animation beyond subtle opacity/color fade.
- Cover images provide the visual color; UI stays neutral.

---

## 7. Terminal / Typewriter Mode Toggle

A user-facing toggle (separate from the removed light/dark toggle) that adjusts reading experience.

### Terminal Mode (default)
- Slightly higher contrast
- Tighter spacing (line-height: `1.7`)
- Cursor-style blinking caret on focused inputs (optional flourish)

### Typewriter Mode
- Slightly warmer text tone (`--text-primary` shifts to `#EDE6D6` — warm paper)
- More vertical spacing (line-height: `1.9`)
- No UI chrome — hide nav borders, simplify header

### Implementation
- Store preference in `localStorage` as `"reading-mode"`: `"terminal"` | `"typewriter"`
- Apply via `data-reading-mode` attribute on `<html>`
- CSS overrides scoped to `[data-reading-mode="typewriter"]`
- Toggle button placement: footer or a subtle icon in the header (where theme toggle used to be)
- **Must handle Astro view transitions:** listen to `astro:after-swap` to re-apply the reading mode from localStorage after page navigation (same pattern the old theme toggle used)

---

## 8. Pagefind Search Theming

Update CSS vars in `search.astro`:

```css
#pagefind-search {
  --pagefind-ui-font: var(--font-app);
  --pagefind-ui-text: var(--text-primary);
  --pagefind-ui-background: var(--bg-root);
  --pagefind-ui-border: var(--border-subtle);
  --pagefind-ui-primary: var(--accent-primary);
  --pagefind-ui-tag: var(--bg-elevated);
}
```

---

## 9. Accessibility Notes

Contrast ratios against `--bg-root` (`#0E0E0E`):

| Token | Hex | Ratio | WCAG AA (normal text) |
|---|---|---|---|
| `--text-primary` | `#E6E6E6` | 16.5:1 | ✅ Pass |
| `--text-secondary` | `#A8A8A8` | 9.2:1 | ✅ Pass |
| `--text-muted` | `#7A7A7A` | 5.5:1 | ✅ Pass |
| `--text-disabled` | `#5A5A5A` | 3.7:1 | ⚠️ Fails normal text, passes large text only |
| `--accent-primary` | `#D4A259` | 8.5:1 | ✅ Pass |
| `--accent-secondary` | `#8C5A6A` | 4.1:1 | ⚠️ Borderline — use only for large text or decorative elements |

Rules:
- `--text-disabled` must only be used for disabled/non-interactive elements (acceptable per WCAG)
- `--accent-secondary` (wine) should not be used for small body text — fine for blockquote text (typically larger context), tags, and decorative borders

---

## 10. Implementation Order

### Pre-Implementation Checklist

Before starting Phase 1, run these checks:

- [ ] **Grep for all `dark:` classes** across the codebase (`grep -r "dark:" src/`). Every match must be addressed — removing `@custom-variant dark` will silently break any remaining `dark:` prefixed classes.
- [ ] **Grep for all hardcoded hex values** in `.astro`, `.css`, and `.js` files. Every hex value should either move to `theme.ts` or be documented as intentionally local.
- [ ] **Grep for `--shiki-light` and `--shiki-dark`** references. All must be removed when switching to single Shiki theme.

### Phases

| Phase | Scope | Files |
|---|---|---|
| 1 | Create centralized theme + color tokens + remove light mode | `src/theme.ts` (new), `global.css`, `config.ts`, `Layout.astro`, `scripts/theme.ts`, `Header.astro` |
| 2 | Typography rewrite | `typography.css`, `package.json` (remove plugin) |
| 3 | Shiki theme swap | `astro.config.ts`, `typography.css` (code block overrides) |
| 4 | Component migration | All components — token class replacements |
| 5 | Page migration | All pages — token class replacements |
| 6 | Library card redesign | `BookCard.astro`, `BookDetails.astro`, library pages |
| 7 | OG image templates | `og-templates/post.js`, `og-templates/site.js` — import from `theme.ts` |
| 8 | Terminal/Typewriter toggle | New toggle component, CSS overrides generated from `theme.ts` |
| 9 | Pagefind theming | `search.astro` |
| 10 | Visual audit & accessibility check | Full site walkthrough |
