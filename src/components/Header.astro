---
import IconMoon from "@/assets/icons/IconMoon.svg";
import IconSearch from "@/assets/icons/IconSearch.svg";
import IconSunHigh from "@/assets/icons/IconSunHigh.svg";
import LinkButton from "./LinkButton.astro";
import { SITE } from "@/config";

const { pathname } = Astro.url;

const currentPath =
  pathname.endsWith("/") && pathname !== "/" ? pathname.slice(0, -1) : pathname;

const isActive = (path: string) => {
  const currentPathArray = currentPath.split("/").filter(p => p.trim());
  const pathArray = path.split("/").filter(p => p.trim());
  return currentPath === path || currentPathArray[0] === pathArray[0];
};
---

<a
  id="skip-to-content"
  href="#main-content"
  class="absolute start-16 -top-full z-50 bg-background px-3 py-2 text-accent backdrop-blur-lg transition-all focus:top-4"
>
  Skip to content
</a>

<header class="app-layout">
  <div
    class="flex items-center justify-between border-b border-border py-5"
  >
    <a
      href="/"
      class="text-base font-medium tracking-tight text-foreground hover:text-accent transition-colors"
    >
      {SITE.title}
    </a>

    <nav class="flex items-center gap-5">
      <a
        href="/blog"
        class:list={[
          "text-sm transition-colors hover:text-accent",
          isActive("/blog") ? "text-accent" : "text-foreground/60",
        ]}
      >
        Writing
      </a>
      <a
        href="/about"
        class:list={[
          "text-sm transition-colors hover:text-accent",
          isActive("/about") ? "text-accent" : "text-foreground/60",
        ]}
      >
        About
      </a>
      <LinkButton
        href="/search"
        class:list={[
          "flex items-center transition-colors hover:text-accent",
          isActive("/search") ? "text-accent" : "text-foreground/60",
        ]}
        title="Search"
        aria-label="search"
      >
        <IconSearch class="size-4" />
      </LinkButton>
      {
        SITE.lightAndDarkMode && (
          <button
            id="theme-btn"
            class="flex items-center text-foreground/60 hover:text-accent transition-colors focus-outline"
            title="Toggles light & dark"
            aria-label="auto"
            aria-live="polite"
          >
            <IconMoon class="size-4 scale-100 rotate-0 transition-all dark:scale-0 dark:-rotate-90 absolute" />
            <IconSunHigh class="size-4 scale-0 rotate-90 transition-all dark:scale-100 dark:rotate-0" />
          </button>
        )
      }
    </nav>
  </div>
</header>
